---
keywords: fastai
description: "relatos e nuances da constru√ß√£o dos datasets de treino, valida√ß√£o e teste"
title: "um produto orientado a dados governamentais: parte 2"
toc: false
branch: master
badges: true
comments: true
categories: [machine learning, dados abertos, data product]
image: images/posts/govdata_poc_2/govdata_poc_minor_p2.png
hide: false
search_exclude: true
nb_path: _notebooks/2020-07-20-gov-data-product-p2.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-07-20-gov-data-product-p2.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Esse √© o terceiro post de uma s√©rie de como construir um produto <em>data-driven</em> de ponta a ponta, caso voc√™ ainda n√£o tenha acompanhado os demais, abaixo segue uma s√≠ntese com os respectivos links üòÄ.</p>
<ol>
<li>Em <a href="{{ site.baseurl }}{% link _posts/2020-07-07-metadados-normativos-federais.md %}">metadados de normas jur√≠dicas federais</a> coletamos dados do sistema LexML.</li>
<li>Em <a href="{{ site.baseurl }}{% link _posts/2020-07-12-gov-data-product.md%}">um produto orientado a dados governamentais: parte 1</a> realizamos uma an√°lise explorat√≥ria dos dados e definimos um recorte e um escopo para os dados do projeto.</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>No √∫ltimo <a href="{{ site.baseurl }}{% link _posts/2020-07-12-gov-data-product.md %}">post</a> delimitados um escopo para o conjunto de dados que ser√° utilizado em nosso projeto. Portanto, iremos iniciar carregando o subset constru√≠do na etapa anterior.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampling_tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/sampling_tags.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">sampling_tags</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;datePublished&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sampling_tags</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampling_tags</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>legislationIdentifier</th>
      <th>legislationType</th>
      <th>description</th>
      <th>keywords</th>
      <th>year</th>
    </tr>
    <tr>
      <th>datePublished</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1980-12-16</th>
      <td>urn:lex:br:federal:decreto:1988-12-15;97251</td>
      <td>Decreto Legislativo</td>
      <td>ABRE AO MINISTERIO DA AGRICULTURA, EM FAVOR DE...</td>
      <td>DOTA√á√ÉO OR√áAMENTARIA</td>
      <td>1980</td>
    </tr>
    <tr>
      <th>1980-12-16</th>
      <td>urn:lex:br:federal:decreto:1988-12-15;97251</td>
      <td>Decreto Legislativo</td>
      <td>ABRE AO MINISTERIO DA AGRICULTURA, EM FAVOR DE...</td>
      <td>REFOR√áO</td>
      <td>1980</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Precisamos garantr que nosso conjunto de treinamento esteja restrito ao universo delimitado a normativos que possuam apenas as <code>tags</code> delimitadas para a POC, Por exemplo, o Decreto 97.251 de 1988 possui as seguintes classifica√ß√µes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">keywords</span> <span class="o">=</span> <span class="n">sampling_tags</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="c1">#restringir o dataset apenas para os normativos que ser√£o utilizados para o treinamento do modelo</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">population</span><span class="p">[</span><span class="s1">&#39;legislationIdentifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sampling_tags</span><span class="p">[</span><span class="s1">&#39;legislationIdentifier&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sample</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;CREDITO SUPLEMENTAR&#39;,
 &#39;MINISTERIO DA EDUCA√á√ÉO (MEC)&#39;,
 &#39;REFOR√áO&#39;,
 &#39;DOTA√á√ÉO OR√áAMENTARIA&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Todavia, <code>MINISTERIO DA EDUCA√á√ÉO (MEC)</code> n√£o est√° contemplado no rol de <code>tags</code> delimitadas para o projeto, desse modo devemos remov√™-las.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;MINISTERIO DA EDUCA√á√ÉO (MEC)&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Como temos um componente temporal em nosso dataset, isto √©, normativos publicados e classificados ao longo de diferentes anos √© v√°lido realizarmos um verifica√ß√£o se, eventualmente, houve algum per√≠odo se alguma das <code>tags</code> n√£o foi utilizada, por exemplo. Para isso, iremos subdividr o dataset em 4 d√©cadas e verificaremos se para algum delas n√£o h√° ocorr√™ncia de uso de alguma das <code>tags</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decade1</span> <span class="o">=</span> <span class="n">sampling_tags</span><span class="p">[</span><span class="s2">&quot;1980-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;1989-12-31&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">decade2</span> <span class="o">=</span> <span class="n">sampling_tags</span><span class="p">[</span><span class="s2">&quot;1990-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;1999-12-31&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">decade3</span> <span class="o">=</span> <span class="n">sampling_tags</span><span class="p">[</span><span class="s2">&quot;2000-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;2009-12-31&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">decade4</span> <span class="o">=</span> <span class="n">sampling_tags</span><span class="p">[</span><span class="s2">&quot;2010-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;2020-12-31&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">decades</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">decade1</span><span class="p">,</span> <span class="n">decade2</span><span class="p">,</span> <span class="n">decade3</span><span class="p">,</span> <span class="n">decade4</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;80-89&#39;</span><span class="p">,</span> <span class="s1">&#39;90-99&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-2009&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-2020&#39;</span><span class="p">]):</span>
    <span class="n">inspect</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decades</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>80-89 : {&#39;OR√áAMENTO DA SEGURIDADE SOCIAL&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Para d√©cada 80-89 n√£o h√° registro de uso das tag :<code>OR√áAMENTO DA SEGURIDADE SOCIAL</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tirando o fato que na d√©cada de 80 parecia n√£o haver muita preocupa√ß√£o com destina√ß√£o de recursos or√ßament√°rios para fins de seguridade social, no tocante ao nosso problema o fato temporal n√£o se mostrou um fator relevante na hora de realizar a estratifica√ß√£o do dataset para fins de treinamento e avalia√ß√£o.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Como bem apontado por <a href="https://www.fast.ai/2017/11/13/validation-sets/">Rachel Thomas</a>, devemos subdividr o nosso conjunto de dados em 3 diferentes subsets: <strong>treinamento</strong>, <strong>valida√ß√£o</strong> e <strong>teste</strong>. O √∫ltimo, deve ser o mais representativo poss√≠vel da realidade esperada em na "vida real". Portanto, vamos fazer uma amostragem aleat√≥ria que obede√ßa a distribui√ß√£o de frequ√™ncia das <code>tags</code> existentes em nosso dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepara&#231;&#227;o-do-conjunto-de-teste">Prepara&#231;&#227;o do conjunto de teste<a class="anchor-link" href="#Prepara&#231;&#227;o-do-conjunto-de-teste"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Precisamos fazer uma sele√ß√£o de dados para compor o dataset de teste que esteja bem pr√≥xima aos dados reais, principalmente, no que tocante a distribui√ß√£o de frequ√™ncia das <code>tags</code>. Portanto, vamos analisar essa distribui√ß√£o.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_frequency_of_occurrences_for_top_tags</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">freq_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;keywords&#39;</span> <span class="p">:</span> <span class="s1">&#39;percent&#39;</span><span class="p">})</span>
    <span class="n">freq_dataframe</span> <span class="o">=</span> <span class="n">freq_dataframe</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">freq_dataframe</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">freq_dataframe</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">freq_dataframe</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_dataframe</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">freq_dataframe</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calculate_theoretical_test_sampling_frequency</span> <span class="o">=</span> <span class="n">build_frequency_of_occurrences_for_top_tags</span><span class="p">(</span><span class="n">sampling_tags</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calculate_theoretical_test_sampling_frequency</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>percent</th>
      <th>count</th>
      <th>frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MUNICIPIO</th>
      <td>0.083606</td>
      <td>16256</td>
      <td>1359</td>
    </tr>
    <tr>
      <th>EXECU√á√ÉO</th>
      <td>0.052228</td>
      <td>10155</td>
      <td>530</td>
    </tr>
    <tr>
      <th>CONCESS√ÉO</th>
      <td>0.051909</td>
      <td>10093</td>
      <td>523</td>
    </tr>
    <tr>
      <th>SERVI√áO</th>
      <td>0.051395</td>
      <td>9993</td>
      <td>513</td>
    </tr>
    <tr>
      <th>APROVA√á√ÉO</th>
      <td>0.050829</td>
      <td>9883</td>
      <td>502</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Em seguida, podemos criar uma fun√ß√£o para criar o nosso <code>dataset de teste</code> com uma distribui√ß√£o mais pr√≥xima ao desejado.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_test_dataset</span><span class="p">(</span><span class="n">frequency_dataset</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
                        <span class="n">sampling_dataset</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constru√ß√£o do dataset de test.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">sampling_dataset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">container</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()}</span>
    <span class="n">consolida_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">get_frequency</span> <span class="o">=</span> <span class="n">frequency_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="n">get_id_samples</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">get_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">container</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_id_samples</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">get_id_samples</span><span class="p">)</span>
    <span class="p">[</span><span class="n">consolida_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">sampling_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consolida_ids</span><span class="p">]</span>
    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">test_dataset</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">create_test_dataset</span><span class="p">(</span><span class="n">calculate_theoretical_test_sampling_frequency</span><span class="p">,</span> <span class="n">sampling_tags</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Uma vez consolidado o <code>dataset de teste</code>, podemos avaliar a distribui√ß√£o de frequ√™ncia das tags comparado ao nosso conjunto amostral.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calculate_practical_test_sampling_frequency</span> <span class="o">=</span> <span class="n">build_frequency_of_occurrences_for_top_tags</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">:</span> <span class="s1">&#39;pract_percent&#39;</span><span class="p">,</span>
        <span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="s1">&#39;pract_count&#39;</span><span class="p">,</span>
        <span class="s1">&#39;frequency&#39;</span> <span class="p">:</span> <span class="s1">&#39;pract_frequency&#39;</span>
<span class="p">}</span>
<span class="p">)</span>
<span class="c1">#cria um dataframe para comparar os datasets de treino com o da amostra.</span>
<span class="n">compare_theory_with_practical</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">calculate_theoretical_test_sampling_frequency</span><span class="p">,</span> \
     <span class="n">calculate_practical_test_sampling_frequency</span><span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">diff_percent</span><span class="o">=</span><span class="p">((</span><span class="n">calculate_practical_test_sampling_frequency</span><span class="o">.</span><span class="n">pract_percent</span><span class="o">-</span><span class="n">calculate_theoretical_test_sampling_frequency</span><span class="o">.</span><span class="n">percent</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">compare_theory_with_practical</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>percent</th>
      <th>count</th>
      <th>frequency</th>
      <th>pract_percent</th>
      <th>pract_count</th>
      <th>pract_frequency</th>
      <th>diff_percent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MUNICIPIO</th>
      <td>0.083606</td>
      <td>16256</td>
      <td>1359</td>
      <td>0.1004</td>
      <td>5395</td>
      <td>541</td>
      <td>1.650972</td>
    </tr>
    <tr>
      <th>EXECU√á√ÉO</th>
      <td>0.052228</td>
      <td>10155</td>
      <td>530</td>
      <td>0.0747</td>
      <td>4014</td>
      <td>299</td>
      <td>2.267160</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">compare_theory_with_practical</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;diff_percent&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
    <span class="p">[</span><span class="s1">&#39;diff_percent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>CREDITO SUPLEMENTAR   -1.533066
Name: diff_percent, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">compare_theory_with_practical</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;diff_percent&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
    <span class="p">[</span><span class="s1">&#39;diff_percent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RADIODIFUS√ÉO    2.446513
Name: diff_percent, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Para a nossa amostragem realizada para constru√ß√£o do dataset de <code>teste</code> temos uma varia√ß√£o positiva de <strong>+2.45%</strong> da frequ√™ncia esperada para <code>RADIODIFUS√ÉO</code> e de varia√ß√£o negativa <strong>-1.53%</strong> para <code>CREDITO SUPLEMENTAR</code>. Consideramos esses desvios aceit√°veis ao que se esperava para a distribui√ß√£o das <code>tags</code> no dataset original.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Por fim, selecionamos os normativos que far√£o parte do <code>dataset de teste</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_test</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>legislationType</th>
      <th>description</th>
      <th>keywords</th>
      <th>datePublished</th>
    </tr>
    <tr>
      <th>legislationIdentifier</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>urn:lex:br:federal:medida.provisoria:1995-06-27;1037</th>
      <td>Medida_provis%C3%B3ria</td>
      <td>CRIA, A GRATIFICA√ß√ÉO DE DESEMPENHO E PRODUTIVI...</td>
      <td>[AMBITO, CRIA√á√ÉO, CRITERIOS, CORRELA√á√ÉO, DESTI...</td>
      <td>1995-06-28</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepara&#231;&#227;o-do-conjunto-de-treino-e-valida&#231;&#227;o">Prepara&#231;&#227;o do conjunto de treino e valida&#231;&#227;o<a class="anchor-link" href="#Prepara&#231;&#227;o-do-conjunto-de-treino-e-valida&#231;&#227;o"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Uma vez conclu√≠da a constru√ß√£o dos dados de <code>teste</code>, precisamos construir aqueles designados para as etapas de <code>treinamento</code> e <code>valida√ß√£o</code>. Uma das formas mais comuns de realizar isso √© fazer uma separa√ß√£o <strong>70/30</strong>, isto √©, <code>70%</code> dos dados ser√£o destinadas para parte de <code>treinamento</code> e os demais para <code>valida√ß√£o</code>. Um das formas mais comuns, √© fazer uso da fun√ß√£o <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a> da biblioteca <em>scikit-learn</em>. Iremos avaliar se essa abordagem de divis√£o do dataset mediante o uso da fun√ß√£o <code>train_test_split</code> √© satisfatat√≥ria para nosso caso, isto √©, esperamos que ap√≥s o <strong>split</strong> tenhamos uma distribui√ß√£o de frequ√™ncias das <code>tags</code> similar ao nosso conjunto amostral.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Em seguida, exclu√≠mos os normativos que fazem parte do <em>dataset</em> de <code>teste</code> e podemos dar prosseguimento para a delimita√ß√£o dos datasets de <code>treino</code> e <code>valida√ß√£o</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_treino_validacao</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">Y_sample_treino_validacao</span> <span class="o">=</span> <span class="n">sample_treino_validacao</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;legislationType&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;datePublished&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">X_sample_treino_validacao</span> <span class="o">=</span> <span class="n">sample_treino_validacao</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;keywords&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Por fim, podemos fazer uma chamada a fun√ß√£o <code>train_test_split</code> com intuito de separar nosso <em>dataset</em> na propor√ß√£o de <code>70%</code> dos dados para treino e <code>30%</code> para valida√ß√£o.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xTrain</span><span class="p">,</span> <span class="n">xValidate</span><span class="p">,</span> <span class="n">yTrain</span><span class="p">,</span> <span class="n">yValidate</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_sample_treino_validacao</span><span class="p">,</span> 
    <span class="n">Y_sample_treino_validacao</span><span class="p">,</span> 
    <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> 
    <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Vamos inspecionar se para cada um dos conjuntos de dados, foram contemplados com as 47 <code>tags</code> que comp√µe o escopo da nossa POC.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">yTrain</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">)[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">yValidate</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">)[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(47, 47)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>O primeiro requisito que √© a presen√ßa de todas as <code>tags</code> est√° cumprido e em seguida podemos realizar uma avalia√ß√£o da distribui√ß√£o de frequ√™ncia destas em ambos os <code>datasets</code>. Primeiramente, vamos calcular a frequ√™ncia relativa.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_train_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">yTrain</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">)[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span>\
                                  <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>\
                                  <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="s1">&#39;y_train_percentage&#39;</span><span class="p">})</span>
<span class="n">y_train_percentage</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;keywords&#39;</span>

<span class="n">y_validate_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">yValidate</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">)[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]</span>\
                                  <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>\
                                  <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="s1">&#39;y_validate_percentage&#39;</span><span class="p">})</span>
<span class="n">y_validate_percentage</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;keywords&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Depois podemos realizar um c√°lculo para conhecer a diferen√ßa das frequ√™ncias relativas das <code>tags</code> do dataset de <code>treino</code> e <code>valida√ß√£o</code> com aqueles da nossa amostragem.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">analyze_keywords_distribution</span> <span class="o">=</span> <span class="n">y_train_percentage</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y_validate_percentage</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">calculate_theoretical_test_sampling_frequency</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">])</span>\
          <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;percent&#39;</span> <span class="p">:</span> <span class="s1">&#39;sampling_percent&#39;</span><span class="p">}),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">analyze_keywords_distribution</span> <span class="o">=</span> <span class="n">analyze_keywords_distribution</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">diff_train_to_sample</span><span class="o">=</span><span class="p">(</span><span class="n">analyze_keywords_distribution</span><span class="o">.</span><span class="n">y_train_percentage</span><span class="o">-</span><span class="n">analyze_keywords_distribution</span><span class="o">.</span><span class="n">sampling_percent</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">diff_validate_to_sample</span><span class="o">=</span><span class="p">(</span><span class="n">analyze_keywords_distribution</span><span class="o">.</span><span class="n">y_validate_percentage</span><span class="o">-</span><span class="n">analyze_keywords_distribution</span><span class="o">.</span><span class="n">sampling_percent</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>O gr√°fico de barras abaixo, mostra a diferen√ßa encontrada na frequ√™ncia relativa das <code>tags</code> do conjunto de <code>treino</code> quando comparado aos dados <code>amostrais</code>. Assim, √© poss√≠vel concluir que a varia√ß√£o absoluta n√£o foi superior a <strong>0.8%</strong>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">analyze_keywords_distribution</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Diferen√ßa de frequ√™ncias das keywords do conjunto de treino para o conjunto amostral.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;diff_train_to_sample:Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;diferen√ßa de frequ√™ncia / %&#39;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">diff_train_to_sample</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">default_color_1</span><span class="p">),</span>  <span class="c1"># The positive color</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">default_color_2</span><span class="p">),</span>  <span class="c1"># The negative color</span>
    <span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;diff_train_to_sample&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-1c84b14489824d1f8b20f2fe02dd295e"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1c84b14489824d1f8b20f2fe02dd295e") {
      outputDiv = document.getElementById("altair-viz-1c84b14489824d1f8b20f2fe02dd295e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-43497941232aa914de81516d53dae050"}, "mark": "bar", "encoding": {"color": {"condition": {"value": "#323443", "test": "(datum.diff_train_to_sample > 0)"}, "value": "#E7997A"}, "tooltip": [{"type": "nominal", "field": "keywords"}, {"type": "quantitative", "field": "diff_train_to_sample"}], "x": {"type": "nominal", "field": "keywords"}, "y": {"type": "quantitative", "field": "diff_train_to_sample", "title": "diferen\u00e7a de frequ\u00eancia / %"}}, "selection": {"selector021": {"type": "interval", "bind": "scales", "encodings": ["x", "y"]}}, "title": "Diferen\u00e7a de frequ\u00eancias das keywords do conjunto de treino para o conjunto amostral.", "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-43497941232aa914de81516d53dae050": [{"keywords": "MUNICIPIO", "y_train_percentage": 0.08029894477589758, "y_validate_percentage": 0.07980208690540341, "sampling_percent": 0.08360634659397742, "diff_train_to_sample": -0.33074018180798415, "diff_validate_to_sample": -0.38042596885740076}, {"keywords": "APROVA\u00c7\u00c3O", "y_train_percentage": 0.045818382555892906, "y_validate_percentage": 0.04764120903345907, "sampling_percent": 0.05082932599583408, "diff_train_to_sample": -0.5010943439941178, "diff_validate_to_sample": -0.31881169623750105}, {"keywords": "EXECU\u00c7\u00c3O", "y_train_percentage": 0.0451814263572475, "y_validate_percentage": 0.04580414441777299, "sampling_percent": 0.052228251086481346, "diff_train_to_sample": -0.7046824729233847, "diff_validate_to_sample": -0.6424106668708358}, {"keywords": "CONCESS\u00c3O", "y_train_percentage": 0.044512622348669824, "y_validate_percentage": 0.046294028315289275, "sampling_percent": 0.051909378455524985, "diff_train_to_sample": -0.7396756106855161, "diff_validate_to_sample": -0.561535014023571}, {"keywords": "SERVI\u00c7O", "y_train_percentage": 0.04345102868426081, "y_validate_percentage": 0.04487336501249204, "sampling_percent": 0.05139506776043408, "diff_train_to_sample": -0.7944039076173269, "diff_validate_to_sample": -0.6521702747942039}, {"keywords": "DESTINA\u00c7\u00c3O", "y_train_percentage": 0.04232573939998726, "y_validate_percentage": 0.042374957135158965, "sampling_percent": 0.037626970452850565, "diff_train_to_sample": 0.46987689471366945, "diff_validate_to_sample": 0.47479866823084}, {"keywords": "EMPRESA DE TELECOMUNICA\u00c7\u00d5ES", "y_train_percentage": 0.04128537760886643, "y_validate_percentage": 0.04284034683779944, "sampling_percent": 0.049486975081646824, "diff_train_to_sample": -0.8201597472780396, "diff_validate_to_sample": -0.6646628243847381}, {"keywords": "RADIODIFUS\u00c3O", "y_train_percentage": 0.04126414573557825, "y_validate_percentage": 0.04284034683779944, "sampling_percent": 0.049461259546892275, "diff_train_to_sample": -0.8197113811314022, "diff_validate_to_sample": -0.6620912709092832}, {"keywords": "ATO", "y_train_percentage": 0.034193931930614235, "y_validate_percentage": 0.035883995493068144, "sampling_percent": 0.041736312906626896, "diff_train_to_sample": -0.7542380976012661, "diff_validate_to_sample": -0.5852317413558752}, {"keywords": "CREDITO SUPLEMENTAR", "y_train_percentage": 0.0312320856069131, "y_validate_percentage": 0.03189144172831039, "sampling_percent": 0.0240543112094016, "diff_train_to_sample": 0.71777743975115, "diff_validate_to_sample": 0.7837130518908793}, {"keywords": "DECLARA\u00c7\u00c3O", "y_train_percentage": 0.029968789146266377, "y_validate_percentage": 0.029319551266349875, "sampling_percent": 0.02701674081312521, "diff_train_to_sample": 0.2952048333141166, "diff_validate_to_sample": 0.23028104532246652}, {"keywords": "UNI\u00c3O FEDERAL", "y_train_percentage": 0.029947557272978195, "y_validate_percentage": 0.029980894527996866, "sampling_percent": 0.024830920358988866, "diff_train_to_sample": 0.511663691398933, "diff_validate_to_sample": 0.5149974169008}, {"keywords": "DOTA\u00c7\u00c3O OR\u00c7AMENTARIA", "y_train_percentage": 0.027930529310601075, "y_validate_percentage": 0.02824180669181404, "sampling_percent": 0.021343893846272534, "diff_train_to_sample": 0.6586635464328541, "diff_validate_to_sample": 0.6897912845541507}, {"keywords": "REFOR\u00c7O", "y_train_percentage": 0.027251109365379306, "y_validate_percentage": 0.02753147504041542, "sampling_percent": 0.02082444004423072, "diff_train_to_sample": 0.6426669321148586, "diff_validate_to_sample": 0.6707034996184701}, {"keywords": "NORMAS", "y_train_percentage": 0.026667232849954352, "y_validate_percentage": 0.025596433645226083, "sampling_percent": 0.028533957363643378, "diff_train_to_sample": -0.18667245136890254, "diff_validate_to_sample": -0.29375237184172953}, {"keywords": "DESAPROPRIA\u00c7\u00c3O", "y_train_percentage": 0.026221363510902568, "y_validate_percentage": 0.025057561357958166, "sampling_percent": 0.024080026744156144, "diff_train_to_sample": 0.2141336766746424, "diff_validate_to_sample": 0.09775346138020218}, {"keywords": "ALTERA\u00c7\u00c3O", "y_train_percentage": 0.024894371430391304, "y_validate_percentage": 0.024935090383579092, "sampling_percent": 0.0270681718826343, "diff_train_to_sample": -0.21738004522429966, "diff_validate_to_sample": -0.21330814990552088}, {"keywords": "INTERESSE SOCIAL", "y_train_percentage": 0.02235716257245377, "y_validate_percentage": 0.022020281193357173, "sampling_percent": 0.021025021215316173, "diff_train_to_sample": 0.13321413571375956, "diff_validate_to_sample": 0.09952599780410007}, {"keywords": "AUTORIZA\u00c7\u00c3O", "y_train_percentage": 0.02141234421112975, "y_validate_percentage": 0.020452652721305052, "sampling_percent": 0.01888548872373801, "diff_train_to_sample": 0.2526855487391739, "diff_validate_to_sample": 0.15671639975670426}, {"keywords": "IMOVEL RURAL", "y_train_percentage": 0.01973502622136351, "y_validate_percentage": 0.019423896536520845, "sampling_percent": 0.01926607863810528, "diff_train_to_sample": 0.04689475832582307, "diff_validate_to_sample": 0.015781789841556523}, {"keywords": "REFORMA AGRARIA", "y_train_percentage": 0.01955455529841398, "y_validate_percentage": 0.019423896536520845, "sampling_percent": 0.01925579242420346, "diff_train_to_sample": 0.02987628742105175, "diff_validate_to_sample": 0.016810411231738334}, {"keywords": "INSTITUTO NACIONAL DE COLONIZA\u00c7\u00c3O E REFORMA AGRARIA (INCRA)", "y_train_percentage": 0.019289156882311725, "y_validate_percentage": 0.019448390731396658, "sampling_percent": 0.018535757451076194, "diff_train_to_sample": 0.07533994312355317, "diff_validate_to_sample": 0.09126332803204643}, {"keywords": "AREA PRIORITARIA", "y_train_percentage": 0.019172381579226735, "y_validate_percentage": 0.0191789545877627, "sampling_percent": 0.01835574870779438, "diff_train_to_sample": 0.08166328714323545, "diff_validate_to_sample": 0.08232058799683209}, {"keywords": "OR\u00c7AMENTO FISCAL", "y_train_percentage": 0.017027962377120533, "y_validate_percentage": 0.015945720864155195, "sampling_percent": 0.01301720369275079, "diff_train_to_sample": 0.4010758684369743, "diff_validate_to_sample": 0.2928517171404405}, {"keywords": "CRIA\u00c7\u00c3O", "y_train_percentage": 0.015403724070574746, "y_validate_percentage": 0.014892470484495175, "sampling_percent": 0.014014966441227145, "diff_train_to_sample": 0.1388757629347601, "diff_validate_to_sample": 0.08775040432680292}, {"keywords": "RENOVA\u00c7\u00c3O", "y_train_percentage": 0.01466060850548844, "y_validate_percentage": 0.015455836966638907, "sampling_percent": 0.017635713734667113, "diff_train_to_sample": -0.2975105229178673, "diff_validate_to_sample": -0.2179876768028206}, {"keywords": "OBJETIVO", "y_train_percentage": 0.013269920805112636, "y_validate_percentage": 0.012516533581541174, "sampling_percent": 0.011577133746496259, "diff_train_to_sample": 0.16927870586163768, "diff_validate_to_sample": 0.09393998350449156}, {"keywords": "ACORDO INTERNACIONAL", "y_train_percentage": 0.01289836302256948, "y_validate_percentage": 0.012394062607162103, "sampling_percent": 0.009638182426003549, "diff_train_to_sample": 0.3260180596565932, "diff_validate_to_sample": 0.27558801811585537}, {"keywords": "ESTADO DE S\u00c3O PAULO (SP)", "y_train_percentage": 0.012049088091042272, "y_validate_percentage": 0.012100132268652329, "sampling_percent": 0.012297168719623525, "diff_train_to_sample": -0.02480806285812525, "diff_validate_to_sample": -0.019703645097119554}, {"keywords": "PAIS ESTRANGEIRO", "y_train_percentage": 0.011263508779379604, "y_validate_percentage": 0.01055699799147602, "sampling_percent": 0.008542700645459922, "diff_train_to_sample": 0.27208081339196827, "diff_validate_to_sample": 0.20142973460160976}, {"keywords": "BRASIL", "y_train_percentage": 0.011221045032803243, "y_validate_percentage": 0.010140596678587174, "sampling_percent": 0.008270115977061744, "diff_train_to_sample": 0.29509290557414997, "diff_validate_to_sample": 0.18704807015254304}, {"keywords": "AMBITO", "y_train_percentage": 0.010393001974564216, "y_validate_percentage": 0.00994464311958066, "sampling_percent": 0.008897575025072647, "diff_train_to_sample": 0.14954269494915698, "diff_validate_to_sample": 0.10470680945080124}, {"keywords": "CRITERIOS", "y_train_percentage": 0.010318690418055585, "y_validate_percentage": 0.009552736001567629, "sampling_percent": 0.011489700928330805, "diff_train_to_sample": -0.11710105102752197, "diff_validate_to_sample": -0.1936964926763176}, {"keywords": "COMPETENCIA", "y_train_percentage": 0.010191299178326504, "y_validate_percentage": 0.010899916719737422, "sampling_percent": 0.010990819554092627, "diff_train_to_sample": -0.07995203757661229, "diff_validate_to_sample": -0.009090283435520506}, {"keywords": "ESTADO DE MINAS GERAIS (MG)", "y_train_percentage": 0.00972419796598654, "y_validate_percentage": 0.009699701170822516, "sampling_percent": 0.010399362254738087, "diff_train_to_sample": -0.06751642887515477, "diff_validate_to_sample": -0.06996610839155715}, {"keywords": "FIXA\u00c7\u00c3O", "y_train_percentage": 0.009193401133782034, "y_validate_percentage": 0.008940381129672268, "sampling_percent": 0.009941625736107183, "diff_train_to_sample": -0.07482246023251485, "diff_validate_to_sample": -0.10012446064349145}, {"keywords": "UTILIDADE PUBLICA", "y_train_percentage": 0.008651988364933439, "y_validate_percentage": 0.007838142360260618, "sampling_percent": 0.006984339239334482, "diff_train_to_sample": 0.16676491255989567, "diff_validate_to_sample": 0.08538031209261357}, {"keywords": "TEXTO", "y_train_percentage": 0.008535213061848446, "y_validate_percentage": 0.008548474011659236, "sampling_percent": 0.006495744078998123, "diff_train_to_sample": 0.20394689828503237, "diff_validate_to_sample": 0.20527299326611137}, {"keywords": "FUNCIONAMENTO", "y_train_percentage": 0.007728401876897599, "y_validate_percentage": 0.0074707294371234014, "sampling_percent": 0.006233445624501762, "diff_train_to_sample": 0.14949562523958373, "diff_validate_to_sample": 0.12372838126216397}, {"keywords": "COMPOSI\u00c7\u00c3O", "y_train_percentage": 0.007431155650863075, "y_validate_percentage": 0.007593200411502474, "sampling_percent": 0.006269447373158125, "diff_train_to_sample": 0.11617082777049502, "diff_validate_to_sample": 0.1323753038344349}, {"keywords": "OR\u00c7AMENTO DA SEGURIDADE SOCIAL", "y_train_percentage": 0.007165757234760823, "y_validate_percentage": 0.007911624944888061, "sampling_percent": 0.005801424640625402, "diff_train_to_sample": 0.13643325941354206, "diff_validate_to_sample": 0.21102003042626588}, {"keywords": "DISPOSITIVOS", "y_train_percentage": 0.0068685110087263, "y_validate_percentage": 0.006564444226718267, "sampling_percent": 0.0069380512767763, "diff_train_to_sample": -0.006954026805000048, "diff_validate_to_sample": -0.037360705005803296}, {"keywords": "ESTADO DO PARANA (PR)", "y_train_percentage": 0.006804815388861759, "y_validate_percentage": 0.006368490667711752, "sampling_percent": 0.007112916913107208, "diff_train_to_sample": -0.0308101524245449, "diff_validate_to_sample": -0.0744426245395456}, {"keywords": "CORRELA\u00c7\u00c3O", "y_train_percentage": 0.006719887895709038, "y_validate_percentage": 0.006441973252339196, "sampling_percent": 0.007082058271401754, "diff_train_to_sample": -0.03621703756927158, "diff_validate_to_sample": -0.06400850190625583}, {"keywords": "EXECUTIVO", "y_train_percentage": 0.006550032909403597, "y_validate_percentage": 0.006319502277960123, "sampling_percent": 0.005667703859901767, "diff_train_to_sample": 0.088232904950183, "diff_validate_to_sample": 0.06517984180583565}, {"keywords": "ESTADO DO RIO GRANDE DO SUL (RS)", "y_train_percentage": 0.006051083887131362, "y_validate_percentage": 0.005462205457306618, "sampling_percent": 0.006356880191323578, "diff_train_to_sample": -0.030579630419221623, "diff_validate_to_sample": -0.08946747340169599}, {"keywords": "HIPOTESE", "y_train_percentage": 0.00591307671075819, "y_validate_percentage": 0.005584676431685691, "sampling_percent": 0.006989482346285391, "diff_train_to_sample": -0.10764056355272011, "diff_validate_to_sample": -0.14048059145997}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>De forma similar, abaixo temos o mesmo gr√°fico com comparativo entre o dataset de <code>valida√ß√£o</code> e o conjunto de dados <code>amostrais</code>. Assim, de forma an√°loga a sua varia√ß√£o absoluta tamb√©m n√£o foi superior a <strong>0.8%</strong>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">analyze_keywords_distribution</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Diferen√ßa de frequ√™ncias das keywords do conjunto de valida√ß√£o para o conjunto amostral.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;diff_validate_to_sample:Q&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;diferen√ßa de frequ√™ncia / %&#39;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">diff_train_to_sample</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">default_color_1</span><span class="p">),</span>  <span class="c1"># The positive color</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">default_color_2</span><span class="p">)</span>  <span class="c1"># The negative color</span>
    <span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;diff_validate_to_sample&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-519a7fbeeb2a478a9a7353e46f3a4fcd"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-519a7fbeeb2a478a9a7353e46f3a4fcd") {
      outputDiv = document.getElementById("altair-viz-519a7fbeeb2a478a9a7353e46f3a4fcd");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-43497941232aa914de81516d53dae050"}, "mark": "bar", "encoding": {"color": {"condition": {"value": "#323443", "test": "(datum.diff_train_to_sample > 0)"}, "value": "#E7997A"}, "tooltip": [{"type": "nominal", "field": "keywords"}, {"type": "quantitative", "field": "diff_validate_to_sample"}], "x": {"type": "nominal", "field": "keywords"}, "y": {"type": "quantitative", "field": "diff_validate_to_sample", "title": "diferen\u00e7a de frequ\u00eancia / %"}}, "selection": {"selector022": {"type": "interval", "bind": "scales", "encodings": ["x", "y"]}}, "title": "Diferen\u00e7a de frequ\u00eancias das keywords do conjunto de valida\u00e7\u00e3o para o conjunto amostral.", "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-43497941232aa914de81516d53dae050": [{"keywords": "MUNICIPIO", "y_train_percentage": 0.08029894477589758, "y_validate_percentage": 0.07980208690540341, "sampling_percent": 0.08360634659397742, "diff_train_to_sample": -0.33074018180798415, "diff_validate_to_sample": -0.38042596885740076}, {"keywords": "APROVA\u00c7\u00c3O", "y_train_percentage": 0.045818382555892906, "y_validate_percentage": 0.04764120903345907, "sampling_percent": 0.05082932599583408, "diff_train_to_sample": -0.5010943439941178, "diff_validate_to_sample": -0.31881169623750105}, {"keywords": "EXECU\u00c7\u00c3O", "y_train_percentage": 0.0451814263572475, "y_validate_percentage": 0.04580414441777299, "sampling_percent": 0.052228251086481346, "diff_train_to_sample": -0.7046824729233847, "diff_validate_to_sample": -0.6424106668708358}, {"keywords": "CONCESS\u00c3O", "y_train_percentage": 0.044512622348669824, "y_validate_percentage": 0.046294028315289275, "sampling_percent": 0.051909378455524985, "diff_train_to_sample": -0.7396756106855161, "diff_validate_to_sample": -0.561535014023571}, {"keywords": "SERVI\u00c7O", "y_train_percentage": 0.04345102868426081, "y_validate_percentage": 0.04487336501249204, "sampling_percent": 0.05139506776043408, "diff_train_to_sample": -0.7944039076173269, "diff_validate_to_sample": -0.6521702747942039}, {"keywords": "DESTINA\u00c7\u00c3O", "y_train_percentage": 0.04232573939998726, "y_validate_percentage": 0.042374957135158965, "sampling_percent": 0.037626970452850565, "diff_train_to_sample": 0.46987689471366945, "diff_validate_to_sample": 0.47479866823084}, {"keywords": "EMPRESA DE TELECOMUNICA\u00c7\u00d5ES", "y_train_percentage": 0.04128537760886643, "y_validate_percentage": 0.04284034683779944, "sampling_percent": 0.049486975081646824, "diff_train_to_sample": -0.8201597472780396, "diff_validate_to_sample": -0.6646628243847381}, {"keywords": "RADIODIFUS\u00c3O", "y_train_percentage": 0.04126414573557825, "y_validate_percentage": 0.04284034683779944, "sampling_percent": 0.049461259546892275, "diff_train_to_sample": -0.8197113811314022, "diff_validate_to_sample": -0.6620912709092832}, {"keywords": "ATO", "y_train_percentage": 0.034193931930614235, "y_validate_percentage": 0.035883995493068144, "sampling_percent": 0.041736312906626896, "diff_train_to_sample": -0.7542380976012661, "diff_validate_to_sample": -0.5852317413558752}, {"keywords": "CREDITO SUPLEMENTAR", "y_train_percentage": 0.0312320856069131, "y_validate_percentage": 0.03189144172831039, "sampling_percent": 0.0240543112094016, "diff_train_to_sample": 0.71777743975115, "diff_validate_to_sample": 0.7837130518908793}, {"keywords": "DECLARA\u00c7\u00c3O", "y_train_percentage": 0.029968789146266377, "y_validate_percentage": 0.029319551266349875, "sampling_percent": 0.02701674081312521, "diff_train_to_sample": 0.2952048333141166, "diff_validate_to_sample": 0.23028104532246652}, {"keywords": "UNI\u00c3O FEDERAL", "y_train_percentage": 0.029947557272978195, "y_validate_percentage": 0.029980894527996866, "sampling_percent": 0.024830920358988866, "diff_train_to_sample": 0.511663691398933, "diff_validate_to_sample": 0.5149974169008}, {"keywords": "DOTA\u00c7\u00c3O OR\u00c7AMENTARIA", "y_train_percentage": 0.027930529310601075, "y_validate_percentage": 0.02824180669181404, "sampling_percent": 0.021343893846272534, "diff_train_to_sample": 0.6586635464328541, "diff_validate_to_sample": 0.6897912845541507}, {"keywords": "REFOR\u00c7O", "y_train_percentage": 0.027251109365379306, "y_validate_percentage": 0.02753147504041542, "sampling_percent": 0.02082444004423072, "diff_train_to_sample": 0.6426669321148586, "diff_validate_to_sample": 0.6707034996184701}, {"keywords": "NORMAS", "y_train_percentage": 0.026667232849954352, "y_validate_percentage": 0.025596433645226083, "sampling_percent": 0.028533957363643378, "diff_train_to_sample": -0.18667245136890254, "diff_validate_to_sample": -0.29375237184172953}, {"keywords": "DESAPROPRIA\u00c7\u00c3O", "y_train_percentage": 0.026221363510902568, "y_validate_percentage": 0.025057561357958166, "sampling_percent": 0.024080026744156144, "diff_train_to_sample": 0.2141336766746424, "diff_validate_to_sample": 0.09775346138020218}, {"keywords": "ALTERA\u00c7\u00c3O", "y_train_percentage": 0.024894371430391304, "y_validate_percentage": 0.024935090383579092, "sampling_percent": 0.0270681718826343, "diff_train_to_sample": -0.21738004522429966, "diff_validate_to_sample": -0.21330814990552088}, {"keywords": "INTERESSE SOCIAL", "y_train_percentage": 0.02235716257245377, "y_validate_percentage": 0.022020281193357173, "sampling_percent": 0.021025021215316173, "diff_train_to_sample": 0.13321413571375956, "diff_validate_to_sample": 0.09952599780410007}, {"keywords": "AUTORIZA\u00c7\u00c3O", "y_train_percentage": 0.02141234421112975, "y_validate_percentage": 0.020452652721305052, "sampling_percent": 0.01888548872373801, "diff_train_to_sample": 0.2526855487391739, "diff_validate_to_sample": 0.15671639975670426}, {"keywords": "IMOVEL RURAL", "y_train_percentage": 0.01973502622136351, "y_validate_percentage": 0.019423896536520845, "sampling_percent": 0.01926607863810528, "diff_train_to_sample": 0.04689475832582307, "diff_validate_to_sample": 0.015781789841556523}, {"keywords": "REFORMA AGRARIA", "y_train_percentage": 0.01955455529841398, "y_validate_percentage": 0.019423896536520845, "sampling_percent": 0.01925579242420346, "diff_train_to_sample": 0.02987628742105175, "diff_validate_to_sample": 0.016810411231738334}, {"keywords": "INSTITUTO NACIONAL DE COLONIZA\u00c7\u00c3O E REFORMA AGRARIA (INCRA)", "y_train_percentage": 0.019289156882311725, "y_validate_percentage": 0.019448390731396658, "sampling_percent": 0.018535757451076194, "diff_train_to_sample": 0.07533994312355317, "diff_validate_to_sample": 0.09126332803204643}, {"keywords": "AREA PRIORITARIA", "y_train_percentage": 0.019172381579226735, "y_validate_percentage": 0.0191789545877627, "sampling_percent": 0.01835574870779438, "diff_train_to_sample": 0.08166328714323545, "diff_validate_to_sample": 0.08232058799683209}, {"keywords": "OR\u00c7AMENTO FISCAL", "y_train_percentage": 0.017027962377120533, "y_validate_percentage": 0.015945720864155195, "sampling_percent": 0.01301720369275079, "diff_train_to_sample": 0.4010758684369743, "diff_validate_to_sample": 0.2928517171404405}, {"keywords": "CRIA\u00c7\u00c3O", "y_train_percentage": 0.015403724070574746, "y_validate_percentage": 0.014892470484495175, "sampling_percent": 0.014014966441227145, "diff_train_to_sample": 0.1388757629347601, "diff_validate_to_sample": 0.08775040432680292}, {"keywords": "RENOVA\u00c7\u00c3O", "y_train_percentage": 0.01466060850548844, "y_validate_percentage": 0.015455836966638907, "sampling_percent": 0.017635713734667113, "diff_train_to_sample": -0.2975105229178673, "diff_validate_to_sample": -0.2179876768028206}, {"keywords": "OBJETIVO", "y_train_percentage": 0.013269920805112636, "y_validate_percentage": 0.012516533581541174, "sampling_percent": 0.011577133746496259, "diff_train_to_sample": 0.16927870586163768, "diff_validate_to_sample": 0.09393998350449156}, {"keywords": "ACORDO INTERNACIONAL", "y_train_percentage": 0.01289836302256948, "y_validate_percentage": 0.012394062607162103, "sampling_percent": 0.009638182426003549, "diff_train_to_sample": 0.3260180596565932, "diff_validate_to_sample": 0.27558801811585537}, {"keywords": "ESTADO DE S\u00c3O PAULO (SP)", "y_train_percentage": 0.012049088091042272, "y_validate_percentage": 0.012100132268652329, "sampling_percent": 0.012297168719623525, "diff_train_to_sample": -0.02480806285812525, "diff_validate_to_sample": -0.019703645097119554}, {"keywords": "PAIS ESTRANGEIRO", "y_train_percentage": 0.011263508779379604, "y_validate_percentage": 0.01055699799147602, "sampling_percent": 0.008542700645459922, "diff_train_to_sample": 0.27208081339196827, "diff_validate_to_sample": 0.20142973460160976}, {"keywords": "BRASIL", "y_train_percentage": 0.011221045032803243, "y_validate_percentage": 0.010140596678587174, "sampling_percent": 0.008270115977061744, "diff_train_to_sample": 0.29509290557414997, "diff_validate_to_sample": 0.18704807015254304}, {"keywords": "AMBITO", "y_train_percentage": 0.010393001974564216, "y_validate_percentage": 0.00994464311958066, "sampling_percent": 0.008897575025072647, "diff_train_to_sample": 0.14954269494915698, "diff_validate_to_sample": 0.10470680945080124}, {"keywords": "CRITERIOS", "y_train_percentage": 0.010318690418055585, "y_validate_percentage": 0.009552736001567629, "sampling_percent": 0.011489700928330805, "diff_train_to_sample": -0.11710105102752197, "diff_validate_to_sample": -0.1936964926763176}, {"keywords": "COMPETENCIA", "y_train_percentage": 0.010191299178326504, "y_validate_percentage": 0.010899916719737422, "sampling_percent": 0.010990819554092627, "diff_train_to_sample": -0.07995203757661229, "diff_validate_to_sample": -0.009090283435520506}, {"keywords": "ESTADO DE MINAS GERAIS (MG)", "y_train_percentage": 0.00972419796598654, "y_validate_percentage": 0.009699701170822516, "sampling_percent": 0.010399362254738087, "diff_train_to_sample": -0.06751642887515477, "diff_validate_to_sample": -0.06996610839155715}, {"keywords": "FIXA\u00c7\u00c3O", "y_train_percentage": 0.009193401133782034, "y_validate_percentage": 0.008940381129672268, "sampling_percent": 0.009941625736107183, "diff_train_to_sample": -0.07482246023251485, "diff_validate_to_sample": -0.10012446064349145}, {"keywords": "UTILIDADE PUBLICA", "y_train_percentage": 0.008651988364933439, "y_validate_percentage": 0.007838142360260618, "sampling_percent": 0.006984339239334482, "diff_train_to_sample": 0.16676491255989567, "diff_validate_to_sample": 0.08538031209261357}, {"keywords": "TEXTO", "y_train_percentage": 0.008535213061848446, "y_validate_percentage": 0.008548474011659236, "sampling_percent": 0.006495744078998123, "diff_train_to_sample": 0.20394689828503237, "diff_validate_to_sample": 0.20527299326611137}, {"keywords": "FUNCIONAMENTO", "y_train_percentage": 0.007728401876897599, "y_validate_percentage": 0.0074707294371234014, "sampling_percent": 0.006233445624501762, "diff_train_to_sample": 0.14949562523958373, "diff_validate_to_sample": 0.12372838126216397}, {"keywords": "COMPOSI\u00c7\u00c3O", "y_train_percentage": 0.007431155650863075, "y_validate_percentage": 0.007593200411502474, "sampling_percent": 0.006269447373158125, "diff_train_to_sample": 0.11617082777049502, "diff_validate_to_sample": 0.1323753038344349}, {"keywords": "OR\u00c7AMENTO DA SEGURIDADE SOCIAL", "y_train_percentage": 0.007165757234760823, "y_validate_percentage": 0.007911624944888061, "sampling_percent": 0.005801424640625402, "diff_train_to_sample": 0.13643325941354206, "diff_validate_to_sample": 0.21102003042626588}, {"keywords": "DISPOSITIVOS", "y_train_percentage": 0.0068685110087263, "y_validate_percentage": 0.006564444226718267, "sampling_percent": 0.0069380512767763, "diff_train_to_sample": -0.006954026805000048, "diff_validate_to_sample": -0.037360705005803296}, {"keywords": "ESTADO DO PARANA (PR)", "y_train_percentage": 0.006804815388861759, "y_validate_percentage": 0.006368490667711752, "sampling_percent": 0.007112916913107208, "diff_train_to_sample": -0.0308101524245449, "diff_validate_to_sample": -0.0744426245395456}, {"keywords": "CORRELA\u00c7\u00c3O", "y_train_percentage": 0.006719887895709038, "y_validate_percentage": 0.006441973252339196, "sampling_percent": 0.007082058271401754, "diff_train_to_sample": -0.03621703756927158, "diff_validate_to_sample": -0.06400850190625583}, {"keywords": "EXECUTIVO", "y_train_percentage": 0.006550032909403597, "y_validate_percentage": 0.006319502277960123, "sampling_percent": 0.005667703859901767, "diff_train_to_sample": 0.088232904950183, "diff_validate_to_sample": 0.06517984180583565}, {"keywords": "ESTADO DO RIO GRANDE DO SUL (RS)", "y_train_percentage": 0.006051083887131362, "y_validate_percentage": 0.005462205457306618, "sampling_percent": 0.006356880191323578, "diff_train_to_sample": -0.030579630419221623, "diff_validate_to_sample": -0.08946747340169599}, {"keywords": "HIPOTESE", "y_train_percentage": 0.00591307671075819, "y_validate_percentage": 0.005584676431685691, "sampling_percent": 0.006989482346285391, "diff_train_to_sample": -0.10764056355272011, "diff_validate_to_sample": -0.14048059145997}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consideramos ambos os desvios excelentes, portanto, conclu√≠mos que o uso do <code>test_train_split</code> satisfat√≥rio. Por fim, e n√£o menos importante, vamos inspecionar se n√£o houve nenhum erro no processamento e se os tr√™s conjuntos de dados constru√≠dos n√£o compartilham de nenhum normativo em comum.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">sample_test</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">xTrain</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">xValidate</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>set()</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Por conseguinte, com todas as verifica√ß√µes raz√≥aveis tendo sido realizadas e validadas, podemos persistir os dados para as etapas futuras do trabalho.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;keywords&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/xTest.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">sample_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;legislationType&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;datePublished&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/yTest.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">xTrain</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/xTrain.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">xValidate</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/xValidate.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">yTrain</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/yTrain.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">yValidate</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/yValidate.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Assim, conclu√≠mos a constru√ß√£o dos conjuntos de dados necess√°rios para o treinamento do modelo de aprendizado de m√°quina. No pr√≥ximo post, iremos come√ßar a etapa de treinamento üë®‚Äçüíª! At√© mais!</p>

</div>
</div>
</div>
</div>
 

